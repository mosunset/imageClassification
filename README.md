# イメージ分類ユーティリティ

## 概要

このプロジェクトは、ファイル管理と写真整理のためのPythonユーティリティツールです。ファイル名の正規化、ディレクトリ構造の整理、EXIF情報に基づいた写真ファイルの管理など、多様なファイルシステム操作機能を提供します。

## 機能

### ファイル操作

- **_filemany.simDBファイルの削除**: FileMany検索キャッシュファイルを一括削除
- **ファイル名の正規化**: 全角英数を半角に変換、特殊文字をアンダースコアに置換
- **ディレクトリ名の正規化**: フォルダ名を正規化し、システム間の互換性を向上

### ファイル分析

- **拡張子レポート生成**: ディレクトリ内のファイル拡張子の統計情報を生成
- **拡張子ごとのファイル一覧**: 少数の拡張子については完全なファイルパス一覧を表示

### 写真管理

- **EXIF情報レポート生成**: 写真の撮影日情報をレポートとして出力
- **写真ファイル名に撮影日を追加**: EXIF情報から撮影日を抽出しファイル名の先頭に追加
- **撮影日に基づく写真整理**: 写真を撮影年/月日のフォルダ構造に自動整理
- **パス名とEXIF情報の関連性分析**: AIを使用してファイルパスとEXIF情報の一貫性を分析

## 使い方

1. コマンドラインから `python main.py` を実行
2. メニューから実行したい機能を選択
3. 画面の指示に従って操作

```
$ python main.py
ファイルユーティリティ - 選択してください:
1: _filemany.simDBファイルを削除
2: ファイル拡張子レポート生成
3: ファイル名を正規化
4: ディレクトリ名を正規化
5: 写真EXIF情報レポート生成
6: 写真ファイル名に撮影日を追加
7: 写真を撮影日に基づいて整理
8: パス名とEXIF情報の関連性分析
選択 (1-8):
```

## 主要なクラスと機能

### `FileOperations`

- **remove_filemany_files()**: 不要なキャッシュファイルの検索と削除
- **sanitize_filenames()**: ファイル名を正規化して互換性を向上
- **sanitize_directories()**: ディレクトリ名を正規化（下層から上層へ）

### `FileReporter`

- **report_file_extensions()**: 拡張子ごとの統計とファイル一覧の生成

### `PhotoOperations`

- **extract_exif()**: 画像からEXIF情報を抽出
- **report_exif()**: 撮影日情報のあるファイルのレポート作成
- **report_exif_errors()**: 撮影日情報のないファイルの一覧作成
- **rename_photos_with_date()**: ファイル名の先頭に「pYYYY-MM-DD_HH-MM-SS_」形式で撮影日時を追加
- **organize_photos_by_date()**: 写真を「images/YYYY/MM-DD」フォルダ構造に整理
- **analyze_photo_path_exif_correlation()**: AIを使用してファイルパスとEXIF情報の一貫性を分析

### `FileUtils`

- **normalize_name()**: 文字列を正規化（全角→半角、特殊文字→アンダースコア）
- **ensure_unique_path()**: ファイルパスの一意性を保証

## システム要件

- Python 3.6以上
- 必要なライブラリ:
  - Pillow (PIL): 画像処理とEXIF情報抽出
  - OpenAI API (ローカルLLMサーバー使用): 画像パスと内容の相関分析

## インストール

```bash
# 依存ライブラリのインストール
pip install pillow openai
```

## 注意事項

- 大量のファイルを処理する際はバックアップを作成してください
- 関連性分析機能はローカルLLMサーバーを必要とします（http://localhost:1234/v1）
- ファイルパスに日本語などのマルチバイト文字が含まれる場合でも正しく処理されるよう設計されています
